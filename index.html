<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌟 单词小勇士 - 趣味学习</title>
    <link rel="stylesheet" href="style.css">
    <script src="assets/xlsx.full.min.js"></script>
    <script type="module" src="renderer.js" defer></script>
</head>
<body>
    <!-- 背景音乐 -->
    <audio id="bgMusic" loop>
        <source src="assets/music.mp3" type="audio/mpeg">
    </audio>

    <!-- 主容器 -->
    <div class="container">
        <!-- 背景装饰 -->
        <div class="background-decoration"></div>
        
        <!-- 人物图像 -->
        <div class="character-image"></div>

        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 初始页面 -->
            <div id="startScreen" class="screen active">
                <h1 class="title">🌟 单词小勇士 🌟</h1>
                <button class="btn-primary" onclick="startDrawing()">开始冒险</button>
                <div style="margin-top: 1rem;">
                  <button class="btn-secondary" id="flashcardOpenBtn" onclick="openFlashcards()">学习卡片</button>
                </div>
            </div>

            <!-- 抽取中页面 -->
            <div id="drawingScreen" class="screen">
                <h1 class="title-small">🎯 抽取中...</h1>
                <div class="name-display rolling" id="rollingName"></div>
            </div>

            <!-- 结果页面 -->
            <div id="resultScreen" class="screen">
                <h2 class="subtitle">🎉 恭喜！幸运小勇士是</h2>
                <div class="name-display result" id="selectedName"></div>
                <div class="status-row">当前抽取模式：<span id="modeIndicator">--</span></div>
                <button class="btn-secondary" onclick="showWordInput()">抽取单词</button>
            </div>

            <!-- 单词显示页面 -->
            <div id="wordScreen" class="screen">
                <h2 class="subtitle">💪 加油！你的单词是</h2>
                <div class="word-grid" id="wordGrid"></div>
                <button class="btn-back" onclick="resetToStart()">继续冒险</button>
            </div>

            <!-- 学习卡片页面 -->
            <div id="flashcardScreen" class="screen">
                <h2 class="subtitle">📚 学习卡片</h2>
                <div class="flashcard-container">
                    <div class="flashcard" id="flashcard">
                        <div class="face front">
                            <div class="fc-word-row" id="fcWordRow">
                                <div class="fc-word" id="fcWord"></div>
                                <button type="button" class="tts-button fc-tts-btn" id="fcSpeakWordBtn" title="朗读单词">🔊</button>
                            </div>
                            <div class="fc-phonetic" id="fcPhonetic"></div>
                        </div>
                        <div class="face back">
                            <div class="fc-definition" id="fcDefinition"></div>
                            <div class="fc-example-row" id="fcExampleRow">
                                <div class="fc-example" id="fcExample"></div>
                                <button type="button" class="tts-button fc-tts-btn" id="fcSpeakExampleBtn" title="朗读例句">🔊</button>
                            </div>
                            <img class="fc-image" id="fcImage" alt="">
                        </div>
                    </div>
                </div>
                <div class="flashcard-toolbar">
                    <div class="fc-status"><span id="fcIndex">0</span>/<span id="fcCount">0</span></div>
                    <div class="fc-controls">
                        <button class="btn-secondary" id="fcPrevBtn">⬅ 上一张</button>
                        <button class="btn-primary" id="fcFlipBtn">翻面 (Space)</button>
                        <button class="btn-secondary" id="fcNextBtn">下一张 ➡</button>
                    </div>
                    <div class="fc-actions" id="fcActions">
                        <button id="fcFavBtn" class="fc-fav-btn" title="收藏">☆</button>
                        <div class="fc-mastery" id="fcMastery">
                            <button class="fc-m-btn" id="fcM0" data-level="0">M0</button>
                            <button class="fc-m-btn" id="fcM1" data-level="1">M1</button>
                            <button class="fc-m-btn" id="fcM2" data-level="2">M2</button>
                            <button class="fc-m-btn" id="fcM3" data-level="3">M3</button>
                        </div>
                    </div>
                    <div class="fc-prefs">
                        <label>排列
                            <select id="fcOrderSelect">
                                <option value="shuffled">随机</option>
                                <option value="ordered">顺序</option>
                            </select>
                        </label>
                        <label>默认面
                            <select id="fcDefaultFace">
                                <option value="front">正面</option>
                                <option value="back">背面</option>
                            </select>
                        </label>
                        <label class="fc-checkbox"><input type="checkbox" id="fcIncludeImages" checked> 显示图片</label>
                        <label>筛选
                            <select id="fcFilterMode">
                                <option value="all">全部</option>
                                <option value="favorites">收藏</option>
                                <option value="mastery">掌握度</option>
                            </select>
                        </label>
                        <span class="fc-filter-range" id="fcFilterRange">
                            <select id="fcFilterMin">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                            <span class="fc-range-sep">~</span>
                            <select id="fcFilterMax">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </span>
                    </div>
                    <div class="fc-summary" id="fcSummary"></div>
                    <div class="fc-footer">
                        <button class="btn-back" onclick="window.AppCommands?.uiBack?.()">返回</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 设置面板 -->
        <div class="audio-settings-panel">
            <h4>音乐设置</h4>
            <div class="audio-setting-row">
                <label for="volumeSlider">音量</label>
                <input type="range" id="volumeSlider" min="0" max="1" step="0.05" value="1">
            </div>
            <div class="audio-setting-row">
                <label for="playModeSelect">播放模式</label>
                <select id="playModeSelect">
                    <option value="loop">循环播放</option>
                    <option value="once">播放一次</option>
                </select>
            </div>
            <hr>
            <h4>抽取模式</h4>
            <div class="audio-setting-row">
                <label for="drawModeSelect">抽取模式</label>
                <select id="drawModeSelect">
                    <option value="random">完全随机</option>
                    <option value="fair">公平模式</option>
                </select>
            </div>
            <hr>
            <h4>语音播报</h4>
            <div class="audio-setting-row">
                <label for="ttsVoiceSelect">系统语音</label>
                <div class="tts-voice-row">
                    <select id="ttsVoiceSelect">
                        <option value="">系统默认</option>
                    </select>
                    <button type="button" id="ttsRefreshVoicesBtn" class="tts-refresh-btn" title="刷新语音列表">🔄</button>
                </div>
                <small class="tts-hint" id="ttsAvailabilityHint" style="display:none;"></small>
            </div>
            <div class="audio-setting-row">
                <label for="ttsRateSlider">语速 <span class="tts-inline-value" id="ttsRateValue">1×</span></label>
                <input type="range" id="ttsRateSlider" min="0.1" max="3" step="0.05" value="1">
            </div>
            <div class="audio-setting-row">
                <label for="ttsPitchSlider">音调 <span class="tts-inline-value" id="ttsPitchValue">1×</span></label>
                <input type="range" id="ttsPitchSlider" min="0.5" max="2" step="0.05" value="1">
            </div>
            <div class="audio-setting-row">
                <label class="tts-checkbox">
                    <input type="checkbox" id="ttsAutoPlayToggle">
                    自动播报新卡片
                </label>
            </div>
            <hr>
            <h4>会话与历史</h4>
            <div class="audio-setting-row">
                <button id="clearHistoryBtn" class="btn-secondary">清空历史</button>
            </div>
            <div class="audio-setting-row">
                <button id="resetExcludedBtn" class="btn-secondary">手动重置排除列表</button>
            </div>
            <div class="audio-setting-row">
                <button id="newSessionBtn" class="btn-secondary">开始新会话</button>
            </div>
            <div class="audio-setting-row">
                <button id="fullResetBtn" class="btn-back">完全重置</button>
            </div>
            <hr>
            <h4>离线与图片说明</h4>
            <div class="audio-setting-row" style="display:block; text-align:left; color:#fff; font-size:0.95rem; line-height:1.5;">
                <ul style="padding-left:1.2rem;">
                    <li>单词表支持可选列：音标、释义、例句、标签、图片；未填写的字段会使用默认值。</li>
                    <li>标签列可用中文/英文逗号、分号或换行分隔多个标签，导入时会自动整理为标签数组。</li>
                    <li>图片列可填写本地路径或网络 URL。本地图片会复制到 <code>assets/user/</code> 并自动去重。</li>
                    <li>网络图片不会复制，离线时可能无法显示；未提供图片的词条会使用内置占位图。</li>
                </ul>
            </div>
        </div>

        <!-- 全屏按钮 -->
        <button class="fullscreen-toggle" onclick="toggleFullscreen()" id="fullscreenBtn" title="全屏 (F11)">🗖</button>
        <!-- 音乐控制按钮 -->
        <button class="music-toggle" onclick="toggleMusic()" id="musicBtn">🔊</button>
        <!-- 历史面板开关按钮 -->
        <button class="history-toggle" id="historyToggleBtn" title="历史面板 (H)">🕘</button>

        <!-- 拖拽上传覆盖层 -->
        <div id="dragOverlay" class="drag-overlay" aria-hidden="true">
            <div class="drag-box">
                <div class="drag-icon">📥</div>
                <div class="drag-text">拖拽 Excel 文件到此处导入</div>
                <div class="drag-subtext">支持 .xlsx/.xls；可同时拖入学生名单与单词列表</div>
            </div>
        </div>
    </div>

</body>
</html>
